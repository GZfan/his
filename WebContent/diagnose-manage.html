<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>诊断目录管理</title>
</head>
<body>
<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 系统信息 <span class="c-gray en">&gt;</span> 诊断目录管理 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>
<div class="page-container">
		<div class="text-c">		
		<input type="text" class="input-text" style="width:250px" placeholder="疾病分类模糊查询" id="Disecategoryname" name="">
		<button type="submit" class="btn btn-success radius" id="search1" name=""><i class="Hui-iconfont">&#xe665;</i> 搜索</button>
		</div>
	<div class="cl pd-5 bg-1 bk-gray mt-20"> 
		<span class="l">
			
	        <script>
	        	function datade1(){
					confirm("确定删除");
					var chk_value =[];
					$('input[name="diseasetypeitem"]:checked').each(function(){
						chk_value.push($(this).val());
					});
					$.ajax({
							type: "post", 
							url: "diseaseType/deletelist",  
							contentType:"application/json",
							dataType:'json',
							data:JSON.stringify(chk_value), 
							success: function(data){
								alert(data.msg);
							}
					});
	        	}
	        </script>
			<a href="javascript:;" onclick="member_add('新增疾病分类','ds-add1.html','','510')" class="btn btn-primary radius"><i class="Hui-iconfont">&#xe600;</i> 新增疾病分类</a>
			<a href="javascript:;" onclick="change_dt()" class="btn btn-primary radius"><i class="Hui-iconfont">&#xe600;</i> 修改疾病分类</a>
			<a href="javascript:;" onclick="datade1()" class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i> 删除疾病分类</a>
		
	</div>
	<div class="mt-20">
	<table class="table table-border table-bordered table-hover table-bg table-sort">
		<thead>
			<tr class="text-c">
				<th width="25"><input type="checkbox" name="" value=""></th>
				<th width="80">疾病分类编码</th>
				<th width="100">疾病分类名称</th>
				<th width="40">疾病类型</th>
			</tr>
		</thead>
		<tbody id="DisecategoryBody">
			
		</tbody>
	</table>
	</div>
	<br />
	<br />
	<div class="text-c">		
			<input type="text" class="input-text" style="width:250px" placeholder="疾病模糊查询" id="searchname2" name="">
			<button type="submit" class="btn btn-success radius" id="search2" name=""><i class="Hui-iconfont">&#xe665;</i> 搜索</button>
			</div>
	<div class="cl pd-5 bg-1 bk-gray mt-20"> 
		<span class="l">
			
	        <script>
	        	function datade2(){
	        		confirm("确定删除");
					var chk_value =[];
					$('input[name="diseaseitem"]:checked').each(function(){
						chk_value.push($(this).val());
					});
					$.ajax({
							type: "post", 
							url: "disease/deletelist",  
							contentType:"application/json",
							dataType:'json',
							data:JSON.stringify(chk_value), 
							success: function(data){
								alert(data.msg);
							}
					});
	        	}
	        </script>
			<a href="javascript:;" onclick="member_add('新增疾病','disease-add1.html','','510')" class="btn btn-primary radius"><i class="Hui-iconfont">&#xe600;</i> 新增疾病</a>
			<a href="javascript:;" onclick="change_disease()" class="btn btn-primary radius"><i class="Hui-iconfont">&#xe600;</i> 修改疾病</a>
			<a href="javascript:;" onclick="datade2()" class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i> 删除疾病</a>
		
	</div>
	<div class="mt-20">
	<table class="table table-border table-bordered table-hover table-bg table-sort">
		<thead>
			<tr class="text-c">
				<th width="25"><input type="checkbox" name="" value=""></th>
				<th width="80">疾病助记编码</th>
				<th width="80">疾病名称</th>
				<th width="80">国际ICD编码</th>
				<th width="80">所属疾病分类</th>
			</tr>
		</thead>
		<tbody id="deseasebody">
			
		</tbody>
	</table>
	</div>
</div>



<div id="modal-demo1" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content radius">
			<div class="modal-header">
				<h3 class="modal-title">编辑</h3>
				<a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">×</a>
			</div>
			<div class="modal-body" id="update">
					<form   class="form form-horizontal" id="changebox1">
							<div class="row cl">
									<label class="form-label col-xs-3 col-xs-3">id：</label>
									<div class="formControls col-xs-2 col-sm-2">
										<input type="text" class="input-text" value="" placeholder="" id="dtid" name="id">
									</div>
									<label class="form-label col-xs-3 col-xs-3"><span class="c-red">*</span>疾病分类编码：</label>
									<div class="formControls col-xs-2 col-sm-2">
										<input type="text" class="input-text" value="" placeholder="" id="username" name="dicacode">
									</div>
									<label class="form-label col-xs-3 col-sm-3"><span class="c-red">*</span>疾病分类名称：</label>
									<div class="formControls col-xs-2 col-sm-2">
										<input type="text" class="input-text" value="" placeholder="" id="username" name="dicaname">
									</div>
									<label class="form-label col-xs-3 col-sm-3"><span class="c-red">*</span>疾病类型：</label>
									<div class="formControls col-xs-2 col-sm-2">
											<span class="select-box"><select class="select" name="dicatype">
												<option value="1">西医</option>
												<option value="2">中医</option>
											</select></span>
										</div>
									<div class="formControls col-xs-5 col-sm-5">
											<input class="btn btn-primary radius" type="submit" onclick="updateds(event)"  value="&nbsp;&nbsp;保存&nbsp;&nbsp;">
									</div>
								</div>
										
							
							
					</form>
					
			</div>
			
		</div>
	</div>
</div>
<div id="modal-demo2" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content radius">
			<div class="modal-header">
				<h3 class="modal-title">编辑</h3>
				<a class="close" data-dismiss="modal" aria-hidden="true" href="javascript:void();">×</a>
			</div>
			<div class="modal-body" id="updatedepartment">
					<form   class="form form-horizontal" id="changebox2">
						<div class="row cl">
								<label class="form-label col-xs-3 col-xs-3">id：</label>
								<div class="formControls col-xs-2 col-sm-2">
									<input type="text" class="input-text" value="" placeholder="" id="did" name="id">
								</div>
								<label class="form-label col-xs-3 col-xs-3"><span class="c-red">*</span>疾病编码：</label>
								<div class="formControls col-xs-2 col-sm-2">
									<input type="text" class="input-text" value="" placeholder="" id="username" name="diseasecode">
								</div>
								<label class="form-label col-xs-3 col-sm-3"><span class="c-red">*</span>疾病名称：</label>
								<div class="formControls col-xs-2 col-sm-2">
									<input type="text" class="input-text" value="" placeholder="" id="username" name="diseasename">
								</div>
								<label class="form-label col-xs-3 col-sm-3"><span class="c-red">*</span>国际ICD编码：</label>
								<div class="formControls col-xs-2 col-sm-2">
									<input type="text" class="input-text" value="" placeholder="" id="username" name="diseaseicd">
								</div>
								<label class="form-label col-xs-3 col-sm-3"><span class="c-red">*</span>疾病所属分类：</label>
								<div class="formControls col-xs-2 col-sm-2">
										<span class="select-box"><select class="select" name="disecategoryid" id="classify">
											
										</select></span>
								</div>
								<div class="formControls col-xs-5 col-sm-5">
										<input class="btn btn-primary radius" type="submit" onclick="updatedisease(event)" value="&nbsp;&nbsp;保存&nbsp;&nbsp;">
								</div>
						</div>
											
							
					</form>
					
			</div>
			
		</div>
	</div>
</div>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script> 
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script> 
<script type="text/javascript" src="lib/datatables/1.10.0/jquery.dataTables.min.js"></script> 
<script type="text/javascript" src="lib/laypage/1.2/laypage.js"></script>
<script type="text/javascript">
$(function(){
	$.ajax({
		type: "get", 
		url: "diseaseType/getAllDiseaseType",  
		success: function(data){
			if(data.status="OK"){
				$("#classify").empty();
				diseaseType=data.data;
				for(var i=0;i<diseaseType.length;i++){
					$("#classify").append("<option value=\""+diseaseType[i].id+"\">"+diseaseType[i].dicaname+"</option>");
				}
				
			}
			
		}
	})
	$("#dtid").attr("disabled","disabled");
	$("#did").attr("disabled","disabled");
	$("#search1").click(function(){
		var location="diseaseType/getDiseaseType?diseasename="+$("#Disecategoryname").val();
		$.ajax({
			type: "get", 
			url: location,
			success: function(data){
				if(data.status=="OK"){
					items=data.data;
					$("#DisecategoryBody").empty();
					for(var i=0;i<items.length;i++){
						adddiseasetypeline(items[i]);
					}
				}else {
					alert("没有符合条件的疾病分类！")
				}
			}
		});
	});
	$("#search2").click(function(){
		
		var location="disease/getDisease?name="+$("#searchname2").val();
		$.ajax({
			type: "get", 
			url: location,  
			success: function(data){
				if(data.status=="OK"){
					items=data.data;
					$("#deseasebody").empty();
					for(var i=0;i<items.length;i++){
						adddiseaseline(items[i]);
					}
				}else {
					alert("没有符合条件的非药品收费项目！")
				}
			}
		});
	});
});

function change_dt(){
	var chk_value =[];
	$('input[name="diseasetypeitem"]:checked').each(function(){
		chk_value.push($(this).val());
	});
	if(chk_value.length>1){
		alert("每次只能修改一个项目");
	}else {
		$("#modal-demo1").modal("show");
		$.ajax({
			type: "get", 
			url: "diseaseType/getbyid?id="+chk_value[0], 
			success: function(data){
				if(data.status=="OK"){
					$("#dtid").removeAttr("disabled");
					$("#changebox1").loadData(data.data);
					$("#dtid").attr("disabled","disabled");
				}else {
					alert("数据获取失败！");
				}
			}
		});
	}
	
}
function change_disease(){
	var chk_value =[];
	$('input[name="diseaseitem"]:checked').each(function(){
		chk_value.push($(this).val());
	});
	if(chk_value.length>1){
		alert("每次只能修改一个项目");
	}else {
		$("#modal-demo2").modal("show");
		$.ajax({
			type: "get", 
			url: "disease/getDiseaseById?id="+chk_value[0], 
			success: function(data){
				if(data.status=="OK"){
					$("#did").removeAttr("disabled");
					$("#changebox2").loadData(data.data);
					$("#did").attr("disabled","disabled");
				}else {
					alert("数据获取失败！");
				}
			}
		});
	}
	
}

function updateds(event){
	event.preventDefault();
	$("#dtid").removeAttr("disabled");
	var item=$("#changebox1").toJson();
	item.delmark=1;
	$("#dtid").attr("disabled","disabled");
	$("#modal-demo1").modal("hide");
	$.ajax({
			type:'POST',
			url:'diseaseType/update',
			contentType:"application/json",
			dataType:'json',
			data:JSON.stringify(item),
			success:function(data){
				alert(data.msg);
			}
	})
}

function updatedisease(event){
	event.preventDefault();
	$("#did").removeAttr("disabled");
	var item=$("#changebox2").toJson();
	item.delmark=1;
	$("#did").attr("disabled","disabled");
	$("#modal-demo2").modal("hide");
	$.ajax({
			type:'POST',
			url:'disease/update',
			contentType:"application/json",
			dataType:'json',
			data:JSON.stringify(item),
			success:function(data){
				alert(data.msg);
			}
	})
}
function adddiseaseline(item){
	var line,type;
	for(var i=0;i<diseaseType.length;i++){
		if(diseaseType[i].id==item.disecategoryid){
			type=diseaseType[i].dicaname;
		}
	}
	line=line+"<tr class=\"text-c\">";
	line=line+"	<td><input type=\"checkbox\" value=\""+item.id+"\" name=\"diseaseitem\"></td>"
	line=line+"	<td>"+item.diseasecode+"</td>"
	line=line+"	<td>"+item.diseasename+"</td>"
	line=line+"	<td>"+item.diseaseicd+"</td>"
	line=line+"<td>"+type+"</td></tr>";
	$("#deseasebody").append(line);
}

function adddiseasetypeline(item){
	var line,type;
	if(item.dicatype==1){
		type="西医";
	}else {
		type="中医";
	}
	line=line+"<tr class=\"text-c\">";
	line=line+"	<td><input type=\"checkbox\" value=\""+item.id+"\" name=\"diseasetypeitem\"></td>"
	line=line+"	<td>"+item.dicacode+"</td>"
	line=line+"<td>"+item.dicaname+"</td><td>"+type+"</td></tr>";
	$("#DisecategoryBody").append(line);		
}

//将josn对象赋值给form
$.fn.loadData = function (obj) {
	var key, value, tagName, type, arr;

	//this.reset();

	for (var x in obj) {
		if (obj.hasOwnProperty(x)) {
			key = x;
			value = obj[x];

			this.find("[name='" + key + "'],[name='" + key + "[]']").each(function () {
				tagName = $(this)[0].tagName.toUpperCase();
				type = $(this).attr('type');
				if (tagName == 'INPUT') {
					if (type == 'radio') {
						if ($(this).val() == value) {
								$(this).attr('checked', true);
						}
					} else if (type == 'checkbox') {
						arr = value.split(',');
						for (var i = 0; i < arr.length; i++) {
							if ($(this).val() == arr[i]) {
									$(this).attr('checked', true);
								break;
							}
						}
					} else {
						$(this).val(value);
					}
				} else if (tagName == 'SELECT' || tagName == 'TEXTAREA') {
					$(this).val(value);
				}
			});
		}
	}
}



/*用户-添加*/
function member_add(title,url,w,h){
	layer_show(title,url,w,h);
}
/*用户-查看*/
function member_show(title,url,id,w,h){
	layer_show(title,url,w,h);
}

//把表单转换出json对象
$.fn.toJson = function () {
	var self = this,
		json = {},
		push_counters = {},
		patterns = {
			"validate": /^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,
			"key": /[a-zA-Z0-9_]+|(?=\[\])/g,
			"push": /^$/,
			"fixed": /^\d+$/,
			"named": /^[a-zA-Z0-9_]+$/
		};

	this.build = function (base, key, value) {
		base[key] = value;
		return base;
	};

	this.push_counter = function (key) {
		if (push_counters[key] === undefined) {
			push_counters[key] = 0;
		}
		return push_counters[key]++;
	};

	$.each($(this).serializeArray(), function () {
		// skip invalid keys
		if (!patterns.validate.test(this.name)) {
			return;
		}

		var k,
			keys = this.name.match(patterns.key),
			merge = this.value,
			reverse_key = this.name;

		while ((k = keys.pop()) !== undefined) {
			// adjust reverse_key
			reverse_key = reverse_key.replace(new RegExp("\\[" + k + "\\]$"), '');

			// push
			if (k.match(patterns.push)) {
				merge = self.build([], self.push_counter(reverse_key), merge);
			}

			// fixed
			else if (k.match(patterns.fixed)) {
				merge = self.build([], k, merge);
			}

			// named
			else if (k.match(patterns.named)) {
				merge = self.build({}, k, merge);
			}
		}

		json = $.extend(true, json, merge);
	});

	return json;
};
</script> 
</body>
</html>